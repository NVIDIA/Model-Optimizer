#!/bin/bash
########################################################
# QAD Configuration: Qwen3-8B with Nemotron-v1 Dataset
# Best for MMLU accuracy improvement
#
# Usage:
#   sbatch --nodes=4 -t 8:00:00 sbatch_qwen_qad.sh --config configs/qwen3-8b-nemotron.conf
########################################################

########################################################
# MODEL
########################################################
export STUDENT_MODEL="Qwen3-8B"
export TEACHER_MODEL="Qwen3-8B"

########################################################
# CHECKPOINTS (REQUIRED)
########################################################
export STUDENT_CKPT="/lustre/fsw/coreai_dlalgo_modelopt/weimingc/models/Qwen3-8B-NVFP4-TP8-MLM"
export TEACHER_CKPT="/lustre/fsw/coreai_dlalgo_modelopt/weimingc/models/Qwen3-8B-TP8-MLM"
export TEACHER_MODEL_CONFIG="/lustre/fsw/coreai_dlalgo_modelopt/weimingc/models/Qwen3-8B-teacher.yaml"

########################################################
# TRAINING
########################################################
export LR="1e-6"
export DATASET_NAME="nemotron"  # Nemotron-v1 @ 30% (~7.5M samples)

########################################################
# PARALLELISM
########################################################
export TP_SIZE=8
export PP_SIZE=1
export EP_SIZE=1
export MBS=16
export NUM_GPUS=8
export MASTER_PORT=29500

########################################################
# PATHS
########################################################
export MLM_DIR="/lustre/fsw/coreai_dlalgo_modelopt/weimingc/workspace/Megatron-LM"
export MODELOPT_DIR="/lustre/fsw/coreai_dlalgo_modelopt/weimingc/workspace/TensorRT-Model-Optimizer"
export MODELS_ROOT="/lustre/fsw/coreai_dlalgo_modelopt/weimingc/models"
export QAD_CHECKPOINT_ROOT="/lustre/fsw/coreai_dlalgo_modelopt/weimingc/checkpoints"
export DATACACHE_DIR="/lustre/fsw/coreai_dlalgo_modelopt/weimingc/data_cache"

########################################################
# CONTAINER
########################################################
export CONTAINER_IMAGE="/lustre/fsw/coreai_dlalgo_modelopt/weimingc/containers/pytorch_25.06-py3.sqsh"
export CONTAINER_MOUNTS="/lustre/fsw:/lustre/fsw"
export CONTAINER_WORKDIR="/lustre/fsw/coreai_dlalgo_modelopt/weimingc/workspace/TensorRT-Model-Optimizer/examples/llm_qad"
